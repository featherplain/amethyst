language: php

php:
  - "7"

matrix:
  include:
    - php: 7
      env: SNIFF=1
  allow_failures:
    - php: 7
      env: SNIFF=1

branches:
  only:
  - master

before_script:
  - export PHPCS_DIR=/tmp/phpcs
  - export SNIFFS_DIR=/tmp/sniffs
  - if [[ "$SNIFF" == "1" ]]; then bash ./.bin/install-phpcs.sh; fi

script:
  - ls -al style.css
  - if find . -name "*.php" -exec php -l {} \; | grep "^[Parse error|Fatal error]"; then exit 1; fi;
  #for phpcs
  - export PHPCS_DIR=/tmp/phpcs
  - export SNIFFS_DIR=/tmp/sniffs
  - if [[ "$SNIFF" == "1" ]]; then $PHPCS_DIR/scripts/phpcs -p -s -v -n . --standard=./codesniffer.ruleset.xml --extensions=php; fi

after_success: bash ./.bin/deploy.sh

env:
  global:
  - GH_REF: github.com/featherplain/amethyst.git
  - secure: "GPx464flJRRtd66iBD3avvM0qFhovjo3RJB0cXQE/EIjew9HjiXIPM3mcYvT8azr0DI/SpTLhJ1zF2vFkJfGgZ8/ojC0h1q6D6nYyv0ajJxFDA2E/UZpMEkxcHOekpsj8yXGYB1g/zCo0Vwesw9NuLxdF7aHPiMWIgA7e3lTsV7a/EjyZ1xlf9vRtd8U8x9QrevWfFQGHMMiqV+a8BVGSM6u0RY1QFmJZtOm2fUOiJnencq7gDOJxbKzFp18rIZJEqgUhtjct4aPfpP48XtcVSAQbGlLOXDavAh742rgtKj7g/MWAgzgMUYmWp3uUYQe/ErqGFeG7MbOnktqxmUGTN9M5cz7O/ZgO2f8dTwg6QFUlVEZrfra4lWX2XZl9rxS1LRTCG/JvzPM4ap2SOIRXT+lgI7kKkmNO5ux5d3U9PVs8BupPFMqjPUJlRsgjZt6bfanMxM68s9hah3JKr7v4ZPNCAmEJWGfUuLXIi6Ozbp6VhPVLtPBkX8DganEGZlkQf7xzW6YJuLxp9LX3iZ0tPhEt3YgDQwPGYuBTh+QALOMhuFeNCZlLNq7XGdNVefQHc2PJyVmWGilLxRaGF6ygBLRbttEphewMR/BkW7wIgQsOUZC4wOlHVuOU5CfqtuQzNTGZPrszl+oIsCyP7p782gomCaCQMwltfdC4BIE194="
